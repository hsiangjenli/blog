{"type":"getPostById","data":{"title":"[tutorial] Docling + ibm-granite/granite-docling-258M","date":"2025-09-22T16:00:00.000Z","description":"<h1>ğŸ“Œ ç°¡ä»‹</h1>\n<p>ç¤ºç¯„å¦‚ä½•ä½¿ç”¨ Docling æ–‡ä»¶è½‰æ›å·¥å…·èˆ‡ IBM æœ€æ–°æ¨å‡ºçš„ <code>ibm-granite/granite-docling-258M</code> VLMï¼Œå°‡ PDFã€Image ç­‰æª”æ¡ˆè½‰æ›æˆçµæ§‹åŒ–çš„ Markdown æˆ– HTML æ ¼å¼ï¼Œæ–¹ä¾¿å¾ŒçºŒæ­é… LLM ä½¿ç”¨</p>","categories":[],"tags":[{"name":"python","_id":"cmh9kvdm8001jnr3vfhav78en"},{"name":"vlm","_id":"cmh9kvdnc004znr3v7nvk9c0l"}],"content":"<h1>ğŸ“Œ ç°¡ä»‹</h1>\n<p>ç¤ºç¯„å¦‚ä½•ä½¿ç”¨ Docling æ–‡ä»¶è½‰æ›å·¥å…·èˆ‡ IBM æœ€æ–°æ¨å‡ºçš„ <code>ibm-granite/granite-docling-258M</code> VLMï¼Œå°‡ PDFã€Image ç­‰æª”æ¡ˆè½‰æ›æˆçµæ§‹åŒ–çš„ Markdown æˆ– HTML æ ¼å¼ï¼Œæ–¹ä¾¿å¾ŒçºŒæ­é… LLM ä½¿ç”¨</p>\n<span id=\"more\"></span>\n<h1>ğŸš€ ä»‹ç´¹æ–‡ä»¶è½‰æ›å·¥å…· + è¦–è¦ºèªè¨€æ¨¡å‹</h1>\n<h2 id=\"Docling\">Docling</h2>\n<p><img src=\"https://docling-project.github.io/docling/assets/docling_processing.png\" alt=\"\"></p>\n<ul>\n<li>è¼¸å…¥ï¼šPDFã€DOCXã€PPTXã€XLSXã€HTMLã€WAVã€MP3ã€VTTã€imagesï¼ˆPNG, TIFF, JPEG, â€¦ï¼‰</li>\n<li>è¼¸å‡ºï¼šçµ±ä¸€çš„ <a href=\"https://docling-project.github.io/docling/concepts/docling_document/\">DoclingDocument</a></li>\n<li>ç›®çš„ï¼šæä¾›ä¸€å€‹çµ±ä¸€ä¸”ç°¡å–®çš„å·¥å…·ï¼ŒæŠŠå„ç¨®æ–‡ä»¶è½‰æ›æˆçµæ§‹åŒ–æ ¼å¼ï¼ˆLLM-Ready Formatï¼‰</li>\n</ul>\n<h2 id=\"è¦–è¦ºèªè¨€æ¨¡å‹ï¼ˆVision-Language-Model-VLMï¼‰\">è¦–è¦ºèªè¨€æ¨¡å‹ï¼ˆVision Language Model, VLMï¼‰</h2>\n<p>æœ¬æ¬¡å¯¦æ¸¬ IBM æœ€æ–°æ¨å‡ºçš„ VLM æ¨¡å‹ <code>ibm-granite/granite-docling-258M</code>ï¼Œç›¸è¼ƒæ–¼èˆŠç‰ˆçš„ <code>ds4sd/SmolDocling-256M-preview</code>ï¼Œå…©è€…åƒæ•¸é‡å¹¾ä¹ä¸€æ¨£çš„æƒ…æ³ä¸‹ï¼Œæ¨¡å‹é«”ç©å¾ 3.55 GB é™åˆ° 530 MB</p>\n<h3 id=\"èˆŠç‰ˆ-Docling-ä½¿ç”¨çš„-VLM\">èˆŠç‰ˆ Docling ä½¿ç”¨çš„ VLM</h3>\n<p><img src=\"https://hackmd.io/_uploads/rk4ayQ-hlx.png\" alt=\"image\"></p>\n<h3 id=\"æ–°ç‰ˆ-Docling-ä½¿ç”¨çš„-VLM\">æ–°ç‰ˆ Docling ä½¿ç”¨çš„ VLM</h3>\n<p><img src=\"https://hackmd.io/_uploads/HJU0JQb2xg.png\" alt=\"image\"></p>\n<h2 id=\"å¯¦éš›æ“ä½œ\">å¯¦éš›æ“ä½œ</h2>\n<ul>\n<li>Docling + <code>ibm-granite/granite-docling-258M</code></li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uv add docling </span><br><span class=\"line\">uv add mlx-vlm # ç­†è€…ä½¿ç”¨ Macï¼Œè¦ä½¿ç”¨ M ç³»åˆ—æ™¶ç‰‡åŠ é€Ÿæ‰éœ€è¦è£</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ”¯æ´çš„-VLM-æ¨¡å‹\">æ”¯æ´çš„ VLM æ¨¡å‹</h3>\n<ul>\n<li>èˆŠç‰ˆï¼š<code>vlm_model_specs.SMOLDOCLING_MLX</code></li>\n<li>æ–°ç‰ˆï¼š<code>vlm_model_specs.GRANITEDOCLING_MLX</code></li>\n</ul>\n<h3 id=\"æ¨¡çµ„ä»‹ç´¹\">æ¨¡çµ„ä»‹ç´¹</h3>\n<ul>\n<li><code>VlmPipelineOptions</code>ï¼šä½¿ç”¨ VLM é€²è¡Œæ–‡ä»¶è½‰æ›çš„è¨­å®šæª”ï¼ˆä¾‹å¦‚ï¼šæ¨¡å‹åç¨±ã€ä¿å­˜åœ–ç‰‡ç­‰ç­‰â€¦ï¼‰</li>\n<li><code>DocumentConverter</code>ï¼šè¨­å®šä¸åŒ Input Format çš„è™•ç†æ–¹å¼</li>\n</ul>\n<h3 id=\"åœ–ç‰‡è™•ç†æ–¹å¼\">åœ–ç‰‡è™•ç†æ–¹å¼</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">ImageRefMode</span>(<span class=\"built_in\">str</span>, Enum):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;ImageRefMode.&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    PLACEHOLDER = <span class=\"string\">&quot;placeholder&quot;</span>  <span class=\"comment\"># just a place-holder</span></span><br><span class=\"line\">    EMBEDDED = <span class=\"string\">&quot;embedded&quot;</span>  <span class=\"comment\"># embed the image as a base64</span></span><br><span class=\"line\">    REFERENCED = <span class=\"string\">&quot;referenced&quot;</span>  <span class=\"comment\"># reference the image via uri</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>PLACEHOLDER</code>ï¼šä½¿ç”¨ <code>&lt;!-- IMAGE --&gt;</code> ä¾†ä»£è¡¨åœ–ç‰‡ï¼ˆä¸ä¿å­˜åœ–ç‰‡çš„æ„æ€ï¼‰</li>\n<li><code>EMBEDDED</code>ï¼šæŠŠåœ–ç‰‡è½‰æ›æˆ base64ï¼Œç›´æ¥ä¿å­˜åœ¨è½‰æ›å¾Œçš„æ–‡ä»¶å…§</li>\n<li><code>REFERENCED</code>ï¼šä½¿ç”¨ URI å¼•ç”¨åœ–ç‰‡</li>\n</ul>\n<h3 id=\"å®Œæ•´ç¨‹å¼ç¢¼\">å®Œæ•´ç¨‹å¼ç¢¼</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"><span class=\"keyword\">from</span> docling.datamodel.base_models <span class=\"keyword\">import</span> InputFormat</span><br><span class=\"line\"><span class=\"keyword\">from</span> docling.document_converter <span class=\"keyword\">import</span> (</span><br><span class=\"line\">    DocumentConverter,</span><br><span class=\"line\">    ImageFormatOption,</span><br><span class=\"line\">    PdfFormatOption,</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">from</span> docling.pipeline.vlm_pipeline <span class=\"keyword\">import</span> VlmPipeline</span><br><span class=\"line\"><span class=\"keyword\">from</span> docling.datamodel.pipeline_options <span class=\"keyword\">import</span> VlmPipelineOptions</span><br><span class=\"line\"><span class=\"keyword\">from</span> docling.datamodel <span class=\"keyword\">import</span> vlm_model_specs</span><br><span class=\"line\"><span class=\"keyword\">from</span> docling_core.types.doc <span class=\"keyword\">import</span> ImageRefMode</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\">model = vlm_model_specs.GRANITEDOCLING_MLX</span><br><span class=\"line\"></span><br><span class=\"line\">vlm_pipeline_options = VlmPipelineOptions(</span><br><span class=\"line\">    vlm_options=model,</span><br><span class=\"line\">    generate_page_images=<span class=\"literal\">True</span>,</span><br><span class=\"line\">    generate_picture_images=<span class=\"literal\">False</span>,</span><br><span class=\"line\">    images_scale=<span class=\"number\">2.0</span>,</span><br><span class=\"line\">    do_picture_description=<span class=\"literal\">True</span>,</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">converter = DocumentConverter(</span><br><span class=\"line\">    format_options=&#123;</span><br><span class=\"line\">        InputFormat.IMAGE: ImageFormatOption(</span><br><span class=\"line\">            pipeline_cls=VlmPipeline,</span><br><span class=\"line\">            pipeline_options=vlm_pipeline_options,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        InputFormat.PDF: PdfFormatOption(</span><br><span class=\"line\">            pipeline_cls=VlmPipeline,</span><br><span class=\"line\">            pipeline_options=vlm_pipeline_options,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">FILE_PATHS = os.listdir(<span class=\"string\">&quot;data/raw/&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">output_dir = Path(<span class=\"string\">f&quot;data/output/<span class=\"subst\">&#123;model.repo_id.replace(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"string\">&#x27;_&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class=\"line\">output_dir.mkdir(parents=<span class=\"literal\">True</span>, exist_ok=<span class=\"literal\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> file_path <span class=\"keyword\">in</span> FILE_PATHS:</span><br><span class=\"line\">    input_file_path = Path(<span class=\"string\">f&quot;data/raw/<span class=\"subst\">&#123;file_path&#125;</span>&quot;</span>)</span><br><span class=\"line\">    output_file_path = output_dir / <span class=\"string\">f&quot;<span class=\"subst\">&#123;input_file_path.stem&#125;</span>.md&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    doc = converter.convert(source=input_file_path, raises_on_error=<span class=\"literal\">True</span>).document</span><br><span class=\"line\">    output_file_path.parent.mkdir(parents=<span class=\"literal\">True</span>, exist_ok=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(output_file_path, <span class=\"string\">&quot;w&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        f.write(doc.export_to_markdown(image_mode=ImageRefMode.EMBEDDED))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(output_file_path.with_suffix(<span class=\"string\">&quot;.html&quot;</span>), <span class=\"string\">&quot;w&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        f.write(</span><br><span class=\"line\">            doc.export_to_html(image_mode=ImageRefMode.EMBEDDED, split_page_view=<span class=\"literal\">True</span>)</span><br><span class=\"line\">        )</span><br></pre></td></tr></table></figure>\n<h1>ğŸ” é‡é»å›é¡§</h1>\n<ul>\n<li>å®‰è£ docling ä»¥åŠä½¿ç”¨æœ€æ–°çš„æ¨¡å‹ <code>ibm-granite/granite-docling-258M</code> é€²è¡Œè¾¨è­˜</li>\n<li>ä½¿ç”¨ Mac çš„ M ç³»åˆ—æ™¶ç‰‡å¯é¡å¤–å®‰è£ <code>mlx-vlm</code>ï¼Œä¸¦æŒ‘é¸å¯ä»¥åŠ é€Ÿçš„æ¨¡å‹</li>\n<li>å…©ç¨®è¼¸å‡ºæ¨¡å¼ï¼ˆç›´æ¥åŒ¯å‡ºæˆ Markdown æˆ–æ˜¯ HTMLï¼‰</li>\n</ul>\n<h1>ğŸ”— åƒè€ƒè³‡æ–™</h1>\n<ul>\n<li><a href=\"https://docling-project.github.io/docling/usage/vision_models/\">Docling/Vision models</a></li>\n<li><a href=\"https://docling-project.github.io/docling/usage/\">Docling/Usage/Basic-usage</a></li>\n</ul>\n","_path":"tutorial_docling_ibm_granite258m/","_link":"https://hsiangjenli.github.io/blog/tutorial_docling_ibm_granite258m/","_id":"cmh9kvdmr003cnr3vhp7qfdw3"}}