{"type":"getPostById","data":{"title":"[tutorial] Docling + ibm-granite/granite-docling-258M","date":"2025-09-22T16:00:00.000Z","description":"<h1>📌 簡介</h1>\n<p>示範如何使用 Docling 文件轉換工具與 IBM 最新推出的 <code>ibm-granite/granite-docling-258M</code> VLM，將 PDF、Image 等檔案轉換成結構化的 Markdown 或 HTML 格式，方便後續搭配 LLM 使用</p>","categories":[],"tags":[{"name":"python","_id":"cmh9kvdm8001jnr3vfhav78en"},{"name":"vlm","_id":"cmh9kvdnc004znr3v7nvk9c0l"}],"content":"<h1>📌 簡介</h1>\n<p>示範如何使用 Docling 文件轉換工具與 IBM 最新推出的 <code>ibm-granite/granite-docling-258M</code> VLM，將 PDF、Image 等檔案轉換成結構化的 Markdown 或 HTML 格式，方便後續搭配 LLM 使用</p>\n<span id=\"more\"></span>\n<h1>🚀 介紹文件轉換工具 + 視覺語言模型</h1>\n<h2 id=\"Docling\">Docling</h2>\n<p><img src=\"https://docling-project.github.io/docling/assets/docling_processing.png\" alt=\"\"></p>\n<ul>\n<li>輸入：PDF、DOCX、PPTX、XLSX、HTML、WAV、MP3、VTT、images（PNG, TIFF, JPEG, …）</li>\n<li>輸出：統一的 <a href=\"https://docling-project.github.io/docling/concepts/docling_document/\">DoclingDocument</a></li>\n<li>目的：提供一個統一且簡單的工具，把各種文件轉換成結構化格式（LLM-Ready Format）</li>\n</ul>\n<h2 id=\"視覺語言模型（Vision-Language-Model-VLM）\">視覺語言模型（Vision Language Model, VLM）</h2>\n<p>本次實測 IBM 最新推出的 VLM 模型 <code>ibm-granite/granite-docling-258M</code>，相較於舊版的 <code>ds4sd/SmolDocling-256M-preview</code>，兩者參數量幾乎一樣的情況下，模型體積從 3.55 GB 降到 530 MB</p>\n<h3 id=\"舊版-Docling-使用的-VLM\">舊版 Docling 使用的 VLM</h3>\n<p><img src=\"https://hackmd.io/_uploads/rk4ayQ-hlx.png\" alt=\"image\"></p>\n<h3 id=\"新版-Docling-使用的-VLM\">新版 Docling 使用的 VLM</h3>\n<p><img src=\"https://hackmd.io/_uploads/HJU0JQb2xg.png\" alt=\"image\"></p>\n<h2 id=\"實際操作\">實際操作</h2>\n<ul>\n<li>Docling + <code>ibm-granite/granite-docling-258M</code></li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uv add docling </span><br><span class=\"line\">uv add mlx-vlm # 筆者使用 Mac，要使用 M 系列晶片加速才需要裝</span><br></pre></td></tr></table></figure>\n<h3 id=\"支援的-VLM-模型\">支援的 VLM 模型</h3>\n<ul>\n<li>舊版：<code>vlm_model_specs.SMOLDOCLING_MLX</code></li>\n<li>新版：<code>vlm_model_specs.GRANITEDOCLING_MLX</code></li>\n</ul>\n<h3 id=\"模組介紹\">模組介紹</h3>\n<ul>\n<li><code>VlmPipelineOptions</code>：使用 VLM 進行文件轉換的設定檔（例如：模型名稱、保存圖片等等…）</li>\n<li><code>DocumentConverter</code>：設定不同 Input Format 的處理方式</li>\n</ul>\n<h3 id=\"圖片處理方式\">圖片處理方式</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">ImageRefMode</span>(<span class=\"built_in\">str</span>, Enum):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;ImageRefMode.&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    PLACEHOLDER = <span class=\"string\">&quot;placeholder&quot;</span>  <span class=\"comment\"># just a place-holder</span></span><br><span class=\"line\">    EMBEDDED = <span class=\"string\">&quot;embedded&quot;</span>  <span class=\"comment\"># embed the image as a base64</span></span><br><span class=\"line\">    REFERENCED = <span class=\"string\">&quot;referenced&quot;</span>  <span class=\"comment\"># reference the image via uri</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>PLACEHOLDER</code>：使用 <code>&lt;!-- IMAGE --&gt;</code> 來代表圖片（不保存圖片的意思）</li>\n<li><code>EMBEDDED</code>：把圖片轉換成 base64，直接保存在轉換後的文件內</li>\n<li><code>REFERENCED</code>：使用 URI 引用圖片</li>\n</ul>\n<h3 id=\"完整程式碼\">完整程式碼</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"><span class=\"keyword\">from</span> docling.datamodel.base_models <span class=\"keyword\">import</span> InputFormat</span><br><span class=\"line\"><span class=\"keyword\">from</span> docling.document_converter <span class=\"keyword\">import</span> (</span><br><span class=\"line\">    DocumentConverter,</span><br><span class=\"line\">    ImageFormatOption,</span><br><span class=\"line\">    PdfFormatOption,</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">from</span> docling.pipeline.vlm_pipeline <span class=\"keyword\">import</span> VlmPipeline</span><br><span class=\"line\"><span class=\"keyword\">from</span> docling.datamodel.pipeline_options <span class=\"keyword\">import</span> VlmPipelineOptions</span><br><span class=\"line\"><span class=\"keyword\">from</span> docling.datamodel <span class=\"keyword\">import</span> vlm_model_specs</span><br><span class=\"line\"><span class=\"keyword\">from</span> docling_core.types.doc <span class=\"keyword\">import</span> ImageRefMode</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\">model = vlm_model_specs.GRANITEDOCLING_MLX</span><br><span class=\"line\"></span><br><span class=\"line\">vlm_pipeline_options = VlmPipelineOptions(</span><br><span class=\"line\">    vlm_options=model,</span><br><span class=\"line\">    generate_page_images=<span class=\"literal\">True</span>,</span><br><span class=\"line\">    generate_picture_images=<span class=\"literal\">False</span>,</span><br><span class=\"line\">    images_scale=<span class=\"number\">2.0</span>,</span><br><span class=\"line\">    do_picture_description=<span class=\"literal\">True</span>,</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">converter = DocumentConverter(</span><br><span class=\"line\">    format_options=&#123;</span><br><span class=\"line\">        InputFormat.IMAGE: ImageFormatOption(</span><br><span class=\"line\">            pipeline_cls=VlmPipeline,</span><br><span class=\"line\">            pipeline_options=vlm_pipeline_options,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        InputFormat.PDF: PdfFormatOption(</span><br><span class=\"line\">            pipeline_cls=VlmPipeline,</span><br><span class=\"line\">            pipeline_options=vlm_pipeline_options,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">FILE_PATHS = os.listdir(<span class=\"string\">&quot;data/raw/&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">output_dir = Path(<span class=\"string\">f&quot;data/output/<span class=\"subst\">&#123;model.repo_id.replace(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"string\">&#x27;_&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class=\"line\">output_dir.mkdir(parents=<span class=\"literal\">True</span>, exist_ok=<span class=\"literal\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> file_path <span class=\"keyword\">in</span> FILE_PATHS:</span><br><span class=\"line\">    input_file_path = Path(<span class=\"string\">f&quot;data/raw/<span class=\"subst\">&#123;file_path&#125;</span>&quot;</span>)</span><br><span class=\"line\">    output_file_path = output_dir / <span class=\"string\">f&quot;<span class=\"subst\">&#123;input_file_path.stem&#125;</span>.md&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    doc = converter.convert(source=input_file_path, raises_on_error=<span class=\"literal\">True</span>).document</span><br><span class=\"line\">    output_file_path.parent.mkdir(parents=<span class=\"literal\">True</span>, exist_ok=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(output_file_path, <span class=\"string\">&quot;w&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        f.write(doc.export_to_markdown(image_mode=ImageRefMode.EMBEDDED))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(output_file_path.with_suffix(<span class=\"string\">&quot;.html&quot;</span>), <span class=\"string\">&quot;w&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        f.write(</span><br><span class=\"line\">            doc.export_to_html(image_mode=ImageRefMode.EMBEDDED, split_page_view=<span class=\"literal\">True</span>)</span><br><span class=\"line\">        )</span><br></pre></td></tr></table></figure>\n<h1>🔁 重點回顧</h1>\n<ul>\n<li>安裝 docling 以及使用最新的模型 <code>ibm-granite/granite-docling-258M</code> 進行辨識</li>\n<li>使用 Mac 的 M 系列晶片可額外安裝 <code>mlx-vlm</code>，並挑選可以加速的模型</li>\n<li>兩種輸出模式（直接匯出成 Markdown 或是 HTML）</li>\n</ul>\n<h1>🔗 參考資料</h1>\n<ul>\n<li><a href=\"https://docling-project.github.io/docling/usage/vision_models/\">Docling/Vision models</a></li>\n<li><a href=\"https://docling-project.github.io/docling/usage/\">Docling/Usage/Basic-usage</a></li>\n</ul>\n","_path":"tutorial_docling_ibm_granite258m/","_link":"https://hsiangjenli.github.io/blog/tutorial_docling_ibm_granite258m/","_id":"cmh9kvdmr003cnr3vhp7qfdw3"}}