{"type":"getPostById","data":{"title":"[note] AWS 遇到 InvalidToken 或是 InvalidClientTokenId","date":"2025-07-10T16:00:00.000Z","description":"<h1>📌 Introduction</h1>\n<p>使用 AWS CLI 時，若 MFA 產生的 <code>AWS_SESSION_TOKEN</code> 過期，會導致 <code>InvalidToken</code> 或 <code>InvalidClientTokenId</code> 錯誤</p>","categories":[],"tags":[{"name":"aws","_id":"cmgpksfno000pnh3vgcqxcu56"}],"content":"<h1>📌 Introduction</h1>\n<p>使用 AWS CLI 時，若 MFA 產生的 <code>AWS_SESSION_TOKEN</code> 過期，會導致 <code>InvalidToken</code> 或 <code>InvalidClientTokenId</code> 錯誤</p>\n<span id=\"more\"></span>\n<h1>🚀 Quick Start</h1>\n<h2 id=\"問題描述\">問題描述</h2>\n<p>Token ID、Secret 都是正確，卻在操作時無法順利登入（InvalidToken）</p>\n<h3 id=\"使用-aws-s3-ls-出現下面錯誤\">使用 <code>aws s3 ls</code> 出現下面錯誤</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">An error occurred (InvalidToken) when calling the ListBuckets operation: The provided token is malformed or otherwise invalid.</span><br></pre></td></tr></table></figure>\n<h3 id=\"使用-aws-sts-get-session-token-產生-Token-時出現下面錯誤\">使用 <code>aws sts get-session-token</code> 產生 Token 時出現下面錯誤</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">An error occurred (InvalidClientTokenId) when calling the GetSessionToken operation: The security token included in the request is invalid</span><br></pre></td></tr></table></figure>\n<h2 id=\"解決方法\">解決方法</h2>\n<p>會發生這類型問題在於過去曾經使用過 <code>AWS_SESSION_TOKEN</code>，可能已經過期導致無法順利登入，要先 unset 以下參數</p>\n<!-- `~/.aws/credentials` -->\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unset AWS_ACCESS_KEY_ID</span><br><span class=\"line\">unset AWS_SECRET_ACCESS_KEY</span><br><span class=\"line\">unset AWS_SESSION_TOKEN</span><br></pre></td></tr></table></figure>\n<h1>🔁 Recap</h1>\n<ul>\n<li>使用 AWS MFA 進行登入的 Session Token 會在過期後無法使用</li>\n<li>需要先把 <code>AWS_ACCESS_KEY_ID</code>、<code>AWS_SECRET_ACCESS_KEY</code>、<code>AWS_SESSION_TOKEN</code> 從環境變數中去除</li>\n</ul>\n<!-- - 由於當初使用一次性 Token 覆蓋了登入憑證，所以需要確認目前的 `aws_access_key_id` 以及 `aws_secret_access_key` 是否為當初在 AWS IAM 產出的 Access Key -->\n<h1>🔗 References</h1>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/54837248/an-error-occurred-invalidtoken-when-calling-the-listbuckets-operation-the-pr\">An error occurred (InvalidToken) when calling the ListBuckets operation: The provided token is malformed or otherwise invalid. aws s3 ls</a></li>\n<li><a href=\"https://stackoverflow.com/questions/40198127/aws-cli-get-error-the-security-token-included-in-the-request-is-invalid\">aws cli get error “The security token included in the request is invalid”</a></li>\n</ul>\n","_path":"note_aws_mfa_login_error/","_link":"https://hsiangjenli.github.io/blog/note_aws_mfa_login_error/","_id":"cmgpksfnt0016nh3v2496dvss"}}