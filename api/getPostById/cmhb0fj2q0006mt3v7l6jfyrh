{"type":"getPostById","data":{"title":"[note] AWS encounters InvalidToken or InvalidClientTokenId","date":"2025-07-10T16:00:00.000Z","description":"<blockquote>\n<p>Note: This page is an AI-generated (gpt-5-mini-2025-08-07) translation from Traditional Chinese and may contain minor inaccuracies.</p>\n</blockquote>\n<h1>üìå Introduction</h1>\n<p>When using the AWS CLI, if the MFA-generated <code>AWS_SESSION_TOKEN</code> expires, it can cause <code>InvalidToken</code> or <code>InvalidClientTokenId</code> errors</p>","categories":[],"tags":[{"name":"aws","_id":"cmhb0fj2x000omt3v2xgohnsw"}],"content":"<blockquote>\n<p>Note: This page is an AI-generated (gpt-5-mini-2025-08-07) translation from Traditional Chinese and may contain minor inaccuracies.</p>\n</blockquote>\n<h1>üìå Introduction</h1>\n<p>When using the AWS CLI, if the MFA-generated <code>AWS_SESSION_TOKEN</code> expires, it can cause <code>InvalidToken</code> or <code>InvalidClientTokenId</code> errors</p>\n<span id=\"more\"></span>\n<h1>üöÄ Quick Start</h1>\n<h2 id=\"Issue-description\">Issue description</h2>\n<p>The Token ID and Secret are correct, but operations fail to authenticate (InvalidToken)</p>\n<h3 id=\"Running-aws-s3-ls-shows-the-following-error\">Running <code>aws s3 ls</code> shows the following error</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">An error occurred (InvalidToken) when calling the ListBuckets operation: The provided token is malformed or otherwise invalid.</span><br></pre></td></tr></table></figure>\n<h3 id=\"Running-aws-sts-get-session-token-to-generate-a-token-shows-the-following-error\">Running <code>aws sts get-session-token</code> to generate a token shows the following error</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">An error occurred (InvalidClientTokenId) when calling the GetSessionToken operation: The security token included in the request is invalid</span><br></pre></td></tr></table></figure>\n<h2 id=\"Solution\">Solution</h2>\n<p>This issue occurs when an <code>AWS_SESSION_TOKEN</code> was previously used and has likely expired, causing authentication to fail. You should first unset the following environment variables</p>\n<!-- `~/.aws/credentials` -->\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unset AWS_ACCESS_KEY_ID</span><br><span class=\"line\">unset AWS_SECRET_ACCESS_KEY</span><br><span class=\"line\">unset AWS_SESSION_TOKEN</span><br></pre></td></tr></table></figure>\n<h1>üîÅ Recap</h1>\n<ul>\n<li>Session tokens obtained via AWS MFA become unusable after expiration</li>\n<li>You need to remove <code>AWS_ACCESS_KEY_ID</code>, <code>AWS_SECRET_ACCESS_KEY</code>, and <code>AWS_SESSION_TOKEN</code> from environment variables</li>\n</ul>\n<!-- - Because a one-time token once overwrote the login credentials, verify whether the current `aws_access_key_id` and `aws_secret_access_key` are the Access Keys originally generated in AWS IAM -->\n<h1>üîó References</h1>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/54837248/an-error-occurred-invalidtoken-when-calling-the-listbuckets-operation-the-pr\">An error occurred (InvalidToken) when calling the ListBuckets operation: The provided token is malformed or otherwise invalid. aws s3 ls</a></li>\n<li><a href=\"https://stackoverflow.com/questions/40198127/aws-cli-get-error-the-security-token-included-in-the-request-is-invalid\">aws cli get error ‚ÄúThe security token included in the request is invalid‚Äù</a></li>\n</ul>\n","_path":"note-aws-invalidtoken-invalidclienttokenid.en/","_link":"https://hsiangjenli.github.io/blog/note-aws-invalidtoken-invalidclienttokenid.en/","_id":"cmhb0fj2q0006mt3v7l6jfyrh"}}