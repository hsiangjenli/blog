{"type":"getPostByPath","data":{"title":"[tutorial] 使用 AWS SAM 建立與執行 Lambda 函數","date":"2025-06-19T16:00:00.000Z","description":"<h1>📌 Introduction</h1>\n<p>主要介紹如何使用 AWS SAM 建立與執行 Lambda 函數，包含基本安裝、專案結構說明，以及在本地端執行 Lambda 的操作流程</p>","categories":[],"tags":[{"name":"aws","_id":"cmgpksfno000pnh3vgcqxcu56"},{"name":"lambda","_id":"cmgpksfoz004snh3v33tx55g3"}],"content":"<h1>📌 Introduction</h1>\n<p>主要介紹如何使用 AWS SAM 建立與執行 Lambda 函數，包含基本安裝、專案結構說明，以及在本地端執行 Lambda 的操作流程</p>\n<span id=\"more\"></span>\n<h1>🚀 Quick Start</h1>\n<h2 id=\"AWS-CLI\">AWS CLI</h2>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install awscli</span><br></pre></td></tr></table></figure>\n<h2 id=\"AWS-SAM-Serverless-Application-Model-CLI\">AWS SAM (Serverless Application Model) CLI</h2>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install aws-sam-cli</span><br></pre></td></tr></table></figure>\n<h3 id=\"初始化-SAM-project\">初始化 SAM project</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sam init</span><br></pre></td></tr></table></figure>\n<h3 id=\"介紹專案架構\">介紹專案架構</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.</span><br><span class=\"line\">├── __init__.py</span><br><span class=\"line\">├── events</span><br><span class=\"line\">│   └── event.json</span><br><span class=\"line\">├── hello_world</span><br><span class=\"line\">│   ├── __init__.py</span><br><span class=\"line\">│   ├── app.py</span><br><span class=\"line\">│   └── requirements.txt</span><br><span class=\"line\">├── README.md</span><br><span class=\"line\">├── samconfig.toml</span><br><span class=\"line\">├── template.yaml</span><br><span class=\"line\">└── tests</span><br><span class=\"line\">    ├── __init__.py</span><br><span class=\"line\">    ├── integration</span><br><span class=\"line\">    │   ├── __init__.py</span><br><span class=\"line\">    │   └── test_api_gateway.py</span><br><span class=\"line\">    ├── requirements.txt</span><br><span class=\"line\">    └── unit</span><br><span class=\"line\">        ├── __init__.py</span><br><span class=\"line\">        └── test_handler.py</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>events/</code> - 放置模擬事件（Event Payload）的 Json 檔，用來測試 Lambda 函數</li>\n<li><code>hello_world/</code> - Application 的放置處，與 Lambda 有關的函數，包含 handler 函式（例如 <a href=\"http://app.py\">app.py</a>）以及依賴（例如 requirements.txt）</li>\n<li><code>tests/</code> - 單元測試的資料夾</li>\n<li><code>samconfig.toml</code> - 儲存 SAM CLI 執行參數（如部署區域、Stack 名稱、S3 bucket 等），用來簡化 <code>sam deploy</code> 時的設定流程</li>\n<li><code>template.yaml</code> - 定義所有 Lambda 函數，IaC 的主要核心檔案（主要會用到哪些服務，互相的相依關係），是基於 AWS CloudFormation 的擴充語法</li>\n</ul>\n<h4 id=\"template-yaml\"><code>template.yaml</code></h4>\n<blockquote>\n<p>可使用 CloudFormation Linter 工具 <a href=\"https://github.com/aws-cloudformation/cfn-lint\"><code>cfn-lint</code></a> 對檔案偵測格式、屬性錯誤</p>\n</blockquote>\n<p><strong>Header</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">AWSTemplateFormatVersion:</span> <span class=\"string\">&#x27;2010-09-09&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">Transform:</span> <span class=\"string\">AWS::Serverless-2016-10-31</span></span><br><span class=\"line\"><span class=\"attr\">Description:</span> <span class=\"string\">&gt;</span></span><br><span class=\"line\">  <span class=\"string\">TODO....</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li><strong>AWSTemplateFormatVersion</strong> - AWS CloudFormation 的版本號</li>\n<li><strong>Transform</strong> - 告訴 CloudFormation 這個模板要額外使用 SAM 來擴充語法</li>\n<li><strong>Description</strong> - 專案介紹</li>\n</ol>\n<p><strong>Content</strong></p>\n<ol>\n<li><strong>Globals</strong> - 預設設定，提供給 Resources 使用</li>\n<li><strong>Resources</strong> - 建立的 AWS 資源，可參考 <a href=\"https://docs.aws.amazon.com/AWSCloudFormation/latest/TemplateReference/aws-template-resource-type-ref.html\">AWS resource and property types reference</a>、<a href=\"https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-specification-resources-and-properties.html\">AWS SAM resources and properties</a></li>\n<li><strong>Outputs</strong> - 在部署完後預期印出的結果（你需要知道哪些資訊）</li>\n</ol>\n<h4 id=\"samconfig-toml\"><code>samconfig.toml</code></h4>\n<blockquote>\n<p>可參考 <a href=\"https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-config.html\">AWS SAM CLI configuration file</a>、<a href=\"https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/using-sam-cli-configure.html\">Configuring the AWS SAM CLI</a>、<a href=\"https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-command-reference.html\">AWS SAM CLI command reference</a></p>\n</blockquote>\n<p>目的是為了簡化使用 sam 指令時的複雜度</p>\n<table>\n<thead>\n<tr>\n<th>Original</th>\n<th>Optimized with <code>samconfig</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>sam build --cached --parallel --use-containers</code></td>\n<td><code>sam build</code></td>\n</tr>\n<tr>\n<td><code>sam local invoke --env-vars locals.json</code></td>\n<td><code>sam local invoke</code></td>\n</tr>\n<tr>\n<td><code>sam local start-api --env-vars locals.json --warm-containers EAGER</code></td>\n<td><code>sam local start-api</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"Local-Invoke\">Local Invoke</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sam local invoke</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">No current session found, using default AWS::AccountId                                                      </span><br><span class=\"line\">Invoking app.lambda_handler (python3.13)                                                                    </span><br><span class=\"line\">Local image is up-to-date                                                                                   </span><br><span class=\"line\">Using local image: public.ecr.aws/lambda/python:3.13-rapid-x86_64.                                          </span><br><span class=\"line\">                                                                                                            </span><br><span class=\"line\">Mounting /Users/XXXXXX/Documents/TEST/hello_world as </span><br><span class=\"line\">/var/task:ro,delegated, inside runtime container                                                            </span><br><span class=\"line\">START RequestId: f6a6ec50-58b2-432c-9381-ec45ca43b130 Version: $LATEST</span><br><span class=\"line\">END RequestId: e883464b-1216-43ae-b0fe-f7f803a73057</span><br><span class=\"line\">REPORT RequestId: e883464b-1216-43ae-b0fe-f7f803a73057  Init Duration: 1.26 ms  Duration: 381.91 ms     Billed Duration: 382 ms     Memory Size: 128 MB     Max Memory Used: 128 MB</span><br><span class=\"line\">&#123;&quot;statusCode&quot;: 200, &quot;body&quot;: &quot;&#123;\\&quot;message\\&quot;: \\&quot;hello world\\&quot;&#125;&quot;&#125;</span><br></pre></td></tr></table></figure>\n<h1>🔁 Recap</h1>\n<ul>\n<li>安裝指令</li>\n<li>理解 AWS SAM 的專案架構</li>\n<li>知道特定檔案 <code>template.yaml</code>、<code>samconfig.toml</code> 檔案用途以及欄位的官方相關文件</li>\n<li>在地端 Invoke 一個簡單的 <code>Hello World</code> Lambda Function</li>\n</ul>\n<h1>🔗 References</h1>\n<ul>\n<li><a href=\"https://ithelp.ithome.com.tw/articles/10214954\">Day02-環境準備(一)安裝AWS CLI、Docker、AWS SAM CLI</a></li>\n</ul>\n","_path":"tutorial_chinese_aws_sam_install_and_lambda/","_link":"https://hsiangjenli.github.io/blog/tutorial_chinese_aws_sam_install_and_lambda/","_id":"cmgpksfom0034nh3v8z1qam4i"}}